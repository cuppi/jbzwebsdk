{"version":3,"sources":["util/JManagerTrade.js"],"names":["Object","defineProperty","exports","value","JNetworkTrade_1","require","instance","TradeManager","type","paras","default","tradeLockSeat","tradeApplyOrder","seatList","mobile","openId","seatInfos","seatNumberInfos","seat","push","seatModel","SeatIndex","rowNumber","colNumber","seatIds","join","count","length","rowId","columnId","console","log","sectionId","seatNo","list","seatNameInfos","seatId","rowOriNumber","colOriNumber","name","seatsName","applyKey","tradeParas","seatInforParas","bridgeSelf","next","lockSeatCallback","confirmOrderCallback","lockSeatHandlerFrom","cinemaId","platformCinemaId","then","data","orderId","jbzFilmId","filmId","showId","city","callbackCityInfo","cityId","id","cityName","confirmOrderHandlerFrom","error","resolve","reject","amount","originalAmount","lockSeatResultData","delegate","hasOwnProperty","platform","platformData","filmName","cinemaName","showIndex","foretellId","seqid"],"mappings":"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","file":"JManagerTrade.js","sourcesContent":["// /**\n//  * Created by cuppi on 2016/12/7.\n//  */\n'use strict';\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst JNetworkTrade_1 = require(\"../network/JNetworkTrade\");\n// /**\n//  * 交易管理类\n//  * @memberOf module:manager\n//  */\nlet instance = null;\nclass TradeManager {\n    constructor() {\n        if (!instance) {\n            instance = this;\n        }\n        return instance;\n    }\n    /**\n     * 获取单例实例\n     * @returns {TradeManager}\n     */\n    static defaultManager(delegate) {\n        if (!delegate.hasOwnProperty('callbackCityInfo')) {\n            console.log('没有找到城市信息实现');\n            return null;\n        }\n        instance = new TradeManager();\n        instance.callbackCityInfo = delegate.callbackCityInfo;\n        return instance;\n    }\n    /**\n     * 获取交易商务参数（与座位无关的）\n     * @param platform 平台类型\n     * @param platformData 平台数据\n     * @param filmId 电影Id\n     * @param filmName 电影名称\n     * @param cinemaId 影院Id\n     * @param cinemaName 影院名称\n     * @returns {*} 商务参数\n     */\n    static tradeParasFromPlatform(platform, platformData, filmId, filmName, cinemaId, cinemaName) {\n        if (platform === 'wangpiao') {\n            return {\n                jbzFilmId: filmId,\n                filmId: platformData.filmId,\n                showId: platformData.showIndex,\n                cinemaName: cinemaName,\n                platformCinemaId: platformData.cinemaId,\n                cinemaId\n            };\n        }\n        if (platform === 'spider') {\n            return {\n                jbzFilmId: filmId,\n                filmId: platformData.filmId,\n                showId: platformData.showId,\n                platformCinemaId: platformData.cinemaId,\n                cinemaId\n            };\n        }\n        if (platform === 'maizuo') {\n            return {\n                jbzFilmId: filmId,\n                filmId: platformData.filmId,\n                showId: platformData.foretellId,\n                filmName: filmName,\n                cinemaName: cinemaName,\n                platformCinemaId: platformData.cinemaId,\n                cinemaId\n            };\n        }\n        if (platform === 'danche') {\n            return {\n                jbzFilmId: filmId,\n                filmId: platformData.filmId,\n                showId: platformData.id,\n                platformCinemaId: platformData.cinemaId,\n                cinemaId\n            };\n        }\n        if (platform === 'maoyan' || platform === 'meituan' || platform === 'dazhong') {\n            return {\n                jbzFilmId: filmId,\n                filmId: platformData.filmId,\n                showId: platformData.showId,\n                cinemaName: cinemaName,\n                platformCinemaId: platformData.cinemaId,\n                cinemaId\n            };\n        }\n        if (platform === 'baidu') {\n            return {\n                showId: platformData.seqid,\n                platformCinemaId: platformData.cinemaId,\n                cinemaId\n            };\n        }\n        if (platform === 'taobao') {\n            return {\n                jbzFilmId: filmId,\n                filmId: platform.filmId,\n                showId: platform.showId,\n                cinemaName: cinemaName,\n                platformCinemaId: platform.cinemaId,\n                filmName,\n                cinemaId\n            };\n        }\n    }\n    /**\n     * 获取锁座处理者\n     * @param type 平台类型\n     * @param paras 参数\n     * @returns {*} 返回请求promise\n     */\n    lockSeatHandlerFrom(type, paras) {\n        return JNetworkTrade_1.default.tradeLockSeat(type, paras);\n    }\n    /**\n     * 获取下订单处理者\n     * @param type 平台类型\n     * @param paras 参数\n     * @returns {{terminate, then}|*} 返回请求promise\n     */\n    confirmOrderHandlerFrom(type, paras) {\n        return JNetworkTrade_1.default.tradeApplyOrder(type, paras);\n    }\n    /**\n     * 获取锁座时需要的座位参数\n     * @param type 平台类型\n     * @param seatList 座位列表（需要购买的）\n     * @param mobile 手机号码\n     * @param openId 身份标识符（目前跟手机号码一样）\n     * @returns {*} 返回参数对象\n     */\n    seatInforParas(type, seatList, mobile, openId) {\n        // 网票\n        if (type === 'wangpiao') {\n            let seatInfos = [];\n            let seatNumberInfos = [];\n            for (let seat of seatList) {\n                seatInfos.push(seat.seatModel.SeatIndex);\n                seatNumberInfos.push(seat.rowNumber + ':' + seat.colNumber);\n            }\n            return {\n                seatIds: seatInfos.join('|'),\n                count: seatInfos.length,\n                seatNumberInfos: seatNumberInfos.join('|'),\n                mobile,\n                openId\n            };\n        }\n        // 蜘蛛\n        if (type === 'spider') {\n            let seatInfos = [];\n            let seatNumberInfos = [];\n            for (let seat of seatList) {\n                seatInfos.push(seat.seatModel.rowId + ':' + seat.seatModel.columnId);\n                seatNumberInfos.push(seat.rowNumber + ':' + seat.colNumber);\n            }\n            return {\n                seatIds: seatInfos.join('|'),\n                count: seatInfos.length,\n                seatNumberInfos: seatNumberInfos.join('|'),\n                mobile,\n                openId\n            };\n        }\n        // 卖座\n        if (type === 'maizuo') {\n            let seatInfos = [];\n            let seatNumberInfos = [];\n            for (let seat of seatList) {\n                seatInfos.push(seat.seatModel.rowId + ':' + seat.seatModel.columnId);\n                seatNumberInfos.push(seat.rowNumber + ':' + seat.colNumber);\n            }\n            return {\n                seatIds: seatInfos.join('|'),\n                count: seatInfos.length,\n                seatNumberInfos: seatNumberInfos.join('|'),\n                mobile,\n                openId\n            };\n        }\n        // 单车\n        if (type === 'danche') {\n            let seatInfos = [];\n            let seatNumberInfos = [];\n            for (let seat of seatList) {\n                seatInfos.push(seat.seatModel.rowId + ':' + seat.seatModel.columnId);\n                seatNumberInfos.push(seat.rowNumber + ':' + seat.colNumber);\n            }\n            return {\n                seatIds: seatInfos.join('|'),\n                count: seatInfos.length,\n                seatNumberInfos: seatNumberInfos.join('|'),\n                mobile,\n                openId\n            };\n        }\n        // 猫眼\n        if (type === 'maoyan' || type === 'meituan' || type === 'dazhong') {\n            let seatInfos = [];\n            let seatNumberInfos = [];\n            for (let seat of seatList) {\n                if (!seat.seatModel || true) {\n                    console.log(seat);\n                }\n                console.log(seat.seatModel);\n                seatInfos.push({\n                    sectionId: seat.seatModel.sectionId,\n                    columnId: seat.seatModel.columnId,\n                    rowId: seat.seatModel.rowId,\n                    seatNo: seat.seatModel.seatNo\n                });\n                seatNumberInfos.push(seat.rowNumber + ':' + seat.colNumber);\n            }\n            return {\n                seatIds: JSON.stringify({\n                    count: seatList.length,\n                    list: seatInfos\n                }),\n                seatNumberInfos: seatNumberInfos.join('|'),\n                mobile,\n                openId\n            };\n        }\n        // 百度\n        if (type === 'baidu') {\n            let seatIds = [];\n            let seatNumberInfos = [];\n            for (let seat of seatList) {\n                seatIds.push(seat.seatModel.seatNo);\n                seatNumberInfos.push(seat.seatModel.rowId + ':' + seat.seatModel.columnId);\n            }\n            return {\n                count: seatIds.length,\n                //  后台设置特意反过来的\n                seatIds: seatNumberInfos.join('|'),\n                seatNumberInfos: seatIds.join('|'),\n                mobile,\n                openId\n            };\n        }\n        // 淘票票\n        if (type === 'taobao') {\n            let seatInfos = [];\n            let seatNumberInfos = [];\n            let seatNameInfos = [];\n            for (let seat of seatList) {\n                seatInfos.push(seat.seatModel.seatId);\n                seatNumberInfos.push(seat.rowOriNumber + ':' + seat.colOriNumber);\n                seatNameInfos.push(seat.seatModel.name);\n            }\n            return {\n                seatIds: seatInfos.join('|'),\n                count: seatInfos.length,\n                seatNumberInfos: seatNumberInfos.join('|'),\n                seatsName: seatNameInfos.join('|'),\n                applyKey: '',\n                mobile,\n                openId\n            };\n        }\n    }\n    /**\n     * 购票（执行锁座 下订单 的事务）\n     * @param type 平台类型\n     * @param tradeParas 商务参数（与座位无关的参数集合）\n     * @param seatList 座位列表\n     * @param mobile 手机号码\n     * @param openId 身份标识符（同上）\n     * @returns {*} 返回请求promise\n     */\n    buyTicket(type, tradeParas, seatList, mobile) {\n        let paras = Object.assign({}, tradeParas, this.seatInforParas(type, seatList, mobile));\n        let bridgeSelf = this;\n        return {\n            next: function (lockSeatCallback) {\n                return {\n                    next: function (confirmOrderCallback) {\n                        bridgeSelf.lockSeatHandlerFrom(type, Object.assign({}, paras, { cinemaId: paras.platformCinemaId })).then(data => {\n                            lockSeatCallback(null, data);\n                            let orderId = data.orderId;\n                            let { cinemaId, jbzFilmId, filmId, showId } = paras;\n                            let city = this.callbackCityInfo();\n                            let cityId = city.id;\n                            let cityName = city.name;\n                            bridgeSelf.confirmOrderHandlerFrom(type, {\n                                orderId,\n                                cinemaId,\n                                jbzFilmId,\n                                filmId,\n                                showId,\n                                cityId,\n                                cityName\n                            }).then(data => {\n                                confirmOrderCallback(null, data);\n                            }, error => {\n                                confirmOrderCallback(error, null);\n                            });\n                        }, error => {\n                            lockSeatCallback(error, null);\n                        });\n                    }\n                };\n            }\n        };\n    }\n    /**\n     * 锁座\n     * @param type 平台类型\n     * @param tradeParas 商务参数（与座位无关的参数集合）\n     * @param seatList 座位列表\n     * @param mobile 手机号码\n     * @returns {Promise} 返回请求promise\n     */\n    lockSeat(type, tradeParas, seatList, mobile) {\n        let paras = Object.assign({}, tradeParas, this.seatInforParas(type, seatList, mobile));\n        return new Promise((resolve, reject) => {\n            this.lockSeatHandlerFrom(type, Object.assign({}, paras, { cinemaId: paras.platformCinemaId })).then(data => {\n                let orderId = data.orderId;\n                let amount = data.originalAmount;\n                let { cinemaId, jbzFilmId, filmId, showId } = paras;\n                // 下面两个\n                let city = this.callbackCityInfo();\n                let cityId = city.id;\n                let cityName = city.name;\n                resolve({\n                    orderId,\n                    amount,\n                    cinemaId,\n                    jbzFilmId,\n                    filmId,\n                    showId,\n                    cityId,\n                    cityName\n                });\n            }, error => {\n                reject(error);\n            });\n        });\n    }\n    /**\n     * 确认订单\n     * @param type 平台类型\n     * @param lockSeatResultData 锁座成功返回的数据\n     * @returns {Promise}\n     */\n    applyOrder(type, lockSeatResultData) {\n        return new Promise((resolve, reject) => {\n            this.confirmOrderHandlerFrom(type, lockSeatResultData).then(data => {\n                resolve(data);\n            }, error => {\n                reject(error);\n            });\n        });\n    }\n}\nexports.default = TradeManager;\n"]}